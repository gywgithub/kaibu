(function(e){function t(t){for(var r,o,s=t[0],c=t[1],l=t[2],u=0,f=[];u<s.length;u++)o=s[u],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&f.push(i[o][0]),i[o]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);d&&d(t);while(f.length)f.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,o=1;o<n.length;o++){var c=n[o];0!==i[c]&&(r=!1)}r&&(a.splice(t--,1),e=s(s.s=n[0]))}return e}var r={},i={app:0},a=[];function o(e){return s.p+"js/"+({about:"about"}[e]||e)+"."+{about:"4e32d58f"}[e]+".js"}function s(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.e=function(e){var t=[],n=i[e];if(0!==n)if(n)t.push(n[2]);else{var r=new Promise((function(t,r){n=i[e]=[t,r]}));t.push(n[2]=r);var a,c=document.createElement("script");c.charset="utf-8",c.timeout=120,s.nc&&c.setAttribute("nonce",s.nc),c.src=o(e);var l=new Error;a=function(t){c.onerror=c.onload=null,clearTimeout(u);var n=i[e];if(0!==n){if(n){var r=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src;l.message="Loading chunk "+e+" failed.\n("+r+": "+a+")",l.name="ChunkLoadError",l.type=r,l.request=a,n[1](l)}i[e]=void 0}};var u=setTimeout((function(){a({type:"timeout",target:c})}),12e4);c.onerror=c.onload=a,document.head.appendChild(c)}return Promise.all(t)},s.m=e,s.c=r,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/",s.oe=function(e){throw console.error(e),e};var c=window["webpackJsonp"]=window["webpackJsonp"]||[],l=c.push.bind(c);c.push=t,c=c.slice();for(var u=0;u<c.length;u++)t(c[u]);var d=l;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"2d07":function(e,t,n){"use strict";var r=n("3f9c"),i=n.n(r);i.a},"3f9c":function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"VectorLayer",(function(){return J})),n.d(r,"ImageLayer",(function(){return le})),n.d(r,"ItkVtkLayer",(function(){return _e}));n("e260"),n("e6cf"),n("cca6"),n("a79d");var i=n("2b0e"),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("router-view")],1)},o=[],s=n("2877"),c={},l=Object(s["a"])(c,a,o,!1,null,null,null),u=l.exports,d=n("9483");Object(d["a"])("".concat("/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}});n("d3b7");var f=n("8c4f"),p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"sidebar-page"},[n("section",{staticClass:"sidebar-layout"},[n("b-sidebar",{attrs:{position:e.position,fullheight:!0,fullwidth:!1,overlay:!1,open:e.open,mobile:e.mobile,"can-cancel":!0,"expand-on-hover":e.expandOnHover,reduce:e.reduce,type:"is-light"},on:{"update:open":function(t){e.open=t}}},[n("div",{staticClass:"p-1"},[n("div",{staticClass:"block"},[n("img",{staticStyle:{width:"220px"},attrs:{src:"static/img/kaibu-banner.svg"}}),n("button",{staticClass:"button floating-close-btn is-small",on:{click:e.closeSidebar}},[n("b-icon",{attrs:{icon:"chevron-left"}})],1)]),n("div",{staticClass:"block"},[n("div",{staticClass:"field"},[n("b-dropdown",{attrs:{"aria-role":"list"},scopedSlots:e._u([{key:"trigger",fn:function(t){var r=t.active;return n("button",{staticClass:"button is-primary"},[n("span",[e._v("+ Add layer")]),n("b-icon",{attrs:{icon:r?"menu-up":"menu-down"}})],1)}}])},[n("input",{ref:"file_input",staticStyle:{display:"none"},attrs:{type:"file",multiple:""},on:{change:function(t){return e.loadFiles(t)}}}),n("b-dropdown-item",{attrs:{value:"file","aria-role":"listitem"},on:{click:function(t){return e.$refs.file_input.click()}}},[n("b-icon",{attrs:{icon:"file-import"}}),e._v(" From File(s)")],1),e._l(e.layerTypes,(function(t,r){return n("b-dropdown-item",{key:r,attrs:{value:r,"aria-role":"listitem"},on:{click:function(t){return e.newLayer(r)}}},[n("b-icon",{attrs:{icon:"layers"}}),e._v(e._s(r))],1)}))],2),e._v(" "),n("b-button",{attrs:{target:"_blank","icon-left":"github-circle"},on:{click:function(t){return e.goto("https://github.com/imjoy-team/kaibu/")}}},[e._v(" Github ")]),n("b-button",{attrs:{"icon-left":"information-variant"},on:{click:function(t){return e.goto("/#/about")}}})],1)]),n("b-menu",{directives:[{name:"sortable",rawName:"v-sortable",value:e.sortableOptions,expression:"sortableOptions"}],staticClass:"is-custom-mobile",on:{sorted:function(t){return e.layerSorted()}}},[n("b-menu-list",{attrs:{label:"Layers"}},e._l(e.layer_configs.slice().reverse(),(function(t){return n("b-menu-item",{key:t.id,staticClass:"layer-item",on:{click:function(n){return e.selectLayer(t)}}},[n("template",{slot:"label"},[n("button",{staticClass:"button is-small",on:{click:function(n){return e.toggleVisible(t)}}},[t.visible?n("b-icon",{attrs:{icon:"eye-outline"}}):n("b-icon",{attrs:{icon:"eye-off-outline"}})],1),e._v(" "+e._s(t.name.slice(0,30)+(t.name.length>30?"...":""))+" "),n("b-dropdown",{staticClass:"is-pulled-right",attrs:{"aria-role":"list",position:"is-bottom-left"}},[n("b-icon",{attrs:{slot:"trigger",icon:"dots-vertical"},slot:"trigger"}),n("b-dropdown-item",{attrs:{"aria-role":"listitem",icon:"close-circle"},on:{click:function(n){return e.removeLayer(t)}}},[e._v("Remove")])],1)],1)],2)})),1)],1),n("hr",{staticClass:"solid"}),n("div",{directives:[{name:"show",rawName:"v-show",value:e.currentLayer,expression:"currentLayer"}],staticClass:"block",staticStyle:{"min-height":"150px"}},[n("b-menu-list",{attrs:{label:"Properties"}},e._l(e.layer_configs,(function(t){return n(e.layerTypes[t.type],{directives:[{name:"show",rawName:"v-show",value:e.currentLayer===t,expression:"currentLayer === layer"}],key:t.id,ref:"layer_"+t.id,refInFor:!0,tag:"component",attrs:{selected:t.selected,visible:t.visible,map:e.map,config:t},on:{"update-extent":e.updateExtent}})})),1)],1)],1)]),n("button",{directives:[{name:"show",rawName:"v-show",value:!e.open,expression:"!open"}],staticClass:"button floating-menu-btn",on:{click:function(t){return e.openSidebar()}}},[n("img",{staticStyle:{width:"30px"},attrs:{src:"static/img/kaibu-icon.svg"}})]),n("div",{directives:[{name:"show",rawName:"v-show",value:e.showGallery,expression:"showGallery"}]},[n("gallery",{attrs:{collections:e.collections}})],1),n("div",{directives:[{name:"show",rawName:"v-show",value:!e.showGallery,expression:"!showGallery"}],staticClass:"p-1"},[n("div",{style:{width:e.viewerWidth},attrs:{id:"map"}}),e.activeSliders?n("section",{staticClass:"slider-container",style:{width:e.sliderWidth}},e._l(e.activeSliders,(function(t){return n("b-field",{key:t.name,staticStyle:{"margin-bottom":"0px!important"}},[n("label",{staticClass:"label slider-label"},[e._v(e._s(t.name))]),n("b-slider",{staticClass:"slider-body",attrs:{min:t.min||0,max:t.max||1,step:t.step||1},on:{input:t.changed},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"slider.value"}})],1)})),1):e._e()])],1)])},h=[],g=(n("d81d"),n("b0c0"),n("b64b"),n("8a79"),n("b85c")),m=n("5530"),y=(n("5bc0"),n("a2c7")),v=n("5eee"),w=n("3a39");n("25f0");function b(){return Math.random().toString(36).substr(2,10)}var _=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"gallery container"},[!e.collections||e.collections.length<=0?n("p",[e._v(" Nothing to show in the gallery ")]):e._e(),e._l(e.collections,(function(t){return n("div",{key:t.name,staticClass:"tile is-ancestor  is-fluid"},[n("div",{staticClass:"tile is-parent"},e._l(t.items,(function(t){return n("div",{key:t.name,staticClass:"card tile is-child"},[e._m(0,!0),n("div",{staticClass:"card-content"},[n("div",{staticClass:"media"},[e._m(1,!0),n("div",{staticClass:"media-content"},[n("p",{staticClass:"title is-4"},[e._v(e._s(t.name))])])])])])})),0)])}))],2)},x=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"card-image"},[n("figure",{staticClass:"image is-4by3"},[n("img",{attrs:{src:"https://bulma.io/images/placeholders/1280x960.png",alt:"Placeholder image"}})])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"media-left"},[n("figure",{staticClass:"image is-48x48"},[n("img",{attrs:{src:"https://bulma.io/images/placeholders/96x96.png",alt:"Placeholder image"}})])])}],k={name:"Gallery",props:{collections:{type:Array,default:null}}},C=k,L=Object(s["a"])(C,_,x,!1,null,null,null),S=L.exports,I=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"vector-layer"},[n("section",[n("div",{staticClass:"block"},[n("b-tooltip",{attrs:{label:"Cursor",position:"is-top"}},[n("button",{staticClass:"button is-medium",class:{"is-primary":!e.config.draw_enable&&!e.select},on:{click:function(t){e.disableSelectInteraction(),e.config.draw_enable=!1,e.updateDrawInteraction(),e.$forceUpdate()}}},[n("b-icon",{attrs:{icon:"cursor-default-outline",size:"is-medium"}})],1)]),n("b-tooltip",{attrs:{label:"Select/Modify",position:"is-top"}},[n("button",{staticClass:"button is-medium",class:{"is-primary":!e.config.draw_enable&&e.select},on:{click:function(t){e.enableSelectInteraction(),e.config.draw_enable=!1,e.updateDrawInteraction(),e.$forceUpdate()}}},[n("b-icon",{attrs:{icon:"cursor-default",size:"is-medium"}})],1)]),n("b-tooltip",{attrs:{label:"Draw Mode",position:"is-top"}},[n("button",{staticClass:"button is-medium",class:{"is-primary":e.config.draw_enable},on:{click:function(t){e.config.draw_enable=!0,e.updateDrawInteraction(),e.$forceUpdate()}}},[n("b-icon",{attrs:{icon:"lead-pencil",size:"is-medium"}})],1)]),e._v(" "),n("b-tooltip",{attrs:{label:"Freehand Mode",position:"is-top"}},[n("button",{staticClass:"button",class:{"is-primary":e.config.draw_freehand},attrs:{disabled:!e.config.draw_enable},on:{click:function(t){e.config.draw_freehand=!e.config.draw_freehand,e.updateDrawInteraction(),e.$forceUpdate()}}},[n("b-icon",{attrs:{icon:"gesture"}})],1)]),n("b-tooltip",{attrs:{label:"Edge Color",position:"is-top"}},[n("v-swatches",{staticStyle:{top:"10px",margin:"1px"},attrs:{disabled:!e.config.draw_enable,swatches:["#0084ff","#44bec7","#ffc300","#fa3c4c","#d696bb","#ff48c4",{color:"#ffffff",showBorder:!0},"#000000"],"show-border":!0,"trigger-style":{width:"36px",height:"36px","border-radius":"5px"},"swatch-size":"32","show-fallback":"","fallback-input-type":"color","popover-x":"left"},model:{value:e.draw_edge_color,callback:function(t){e.draw_edge_color=t},expression:"draw_edge_color"}})],1),n("b-tooltip",{attrs:{label:"Face Color",position:"is-top"}},[n("v-swatches",{staticStyle:{top:"10px",margin:"1px"},attrs:{disabled:!e.config.draw_enable,swatches:["#0084ff60","#44bec760","#ffc30060","#fa3c4c60","#d696bb60","#f3ea5f60","#ff48c460","#00000000"],"show-border":!0,"trigger-style":{width:"36px",height:"36px","border-radius":"5px"},"swatch-size":"32","show-fallback":"","fallback-input-type":"color","popover-x":"left"},model:{value:e.draw_face_color,callback:function(t){e.draw_face_color=t},expression:"draw_face_color"}})],1)],1),n("div",{staticClass:"block"},e._l(e.draw_types,(function(t,r){return n("b-tooltip",{key:r,attrs:{label:r,position:"is-bottom"}},[n("button",{staticClass:"button",class:{"is-primary":e.config.draw_shape_type===r},attrs:{disabled:!e.config.draw_enable},on:{click:function(t){return e.setDrawType(r)}}},[n("b-icon",{attrs:{icon:t,size:"is-medium"}})],1)])})),1),n("b-field",{attrs:{label:"Edge Width"}},[n("b-numberinput",{attrs:{size:"is-small","controls-position":"compact"},model:{value:e.config.draw_edge_width,callback:function(t){e.$set(e.config,"draw_edge_width",t)},expression:"config.draw_edge_width"}})],1),"Point"===e.config.draw_shape_type?n("b-field",{attrs:{label:"Point Size"}},[n("b-numberinput",{attrs:{size:"is-small","controls-position":"compact"},model:{value:e.config.draw_size,callback:function(t){e.$set(e.config,"draw_size",t)},expression:"config.draw_size"}})],1):e._e()],1),n("br"),n("section",[n("input",{ref:"file_input",staticStyle:{display:"none"},attrs:{type:"file"},on:{change:function(t){return e.loadFeatures(t.target.files[0])}}}),e.vector_source?n("b-button",{attrs:{"icon-left":"file-import"},on:{click:function(t){return e.$refs.file_input.click()}}},[e._v(" Load ")]):e._e(),e.vector_source?n("b-button",{attrs:{"icon-left":"file-export"},on:{click:function(t){return e.exportFeatures()}}},[e._v(" Export ")]):e._e(),e.vector_source?n("b-button",{attrs:{"icon-left":"close"},on:{click:function(t){return e.clearFeatures()}}},[e._v(" Clear ")]):e._e()],1)])},P=[],F=(n("99af"),n("4160"),n("caad"),n("fb6a"),n("3ca3"),n("159b"),n("ddb0"),n("2b3d"),n("96cf"),n("1da1")),O=n("7f75"),j=n.n(O),E=(n("b3a4"),n("3e6b")),R=n("6c77"),z=n("83a6"),T=n("8682"),D=n("8295"),$=n("ce2c"),A=n("2ce2"),V=n("c807"),M=n("b2fc"),U=n("ac29"),B=n("5831"),W=n("a2e1"),K=n("5bc3");function N(){for(var e="0123456789ABCDEF",t="#",n=0;n<6;n++)t+=e[Math.floor(16*Math.random())];return t}function G(e,t){if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(e,t);else{var n=document.createElement("a");document.body.appendChild(n);var r=window.URL.createObjectURL(e);n.href=r,n.download=t,n.click(),setTimeout((function(){window.URL.revokeObjectURL(r),document.body.removeChild(n)}),0)}}var q={name:"vector-layer",type:"vector",components:{VSwatches:j.a},props:{map:{type:v["a"],default:null},selected:{type:Boolean,default:!1},visible:{type:Boolean,default:!1},config:{type:Object,default:function(){return{}}}},data:function(){return{layer:null,select:null,vector_source:null,draw_history:[],draw_edge_color:null,draw_face_color:null,draw_types:{Polygon:"vector-polygon",LineString:"vector-polyline",Rectangle:"vector-rectangle",Square:"vector-square",Circle:"vector-circle-variant",Star:"octagram-outline",Point:"plus-circle-outline"}}},watch:{draw_edge_color:function(e){this.config.draw_edge_color=e},draw_face_color:function(e){this.config.draw_face_color=e},selected:function(){this.updateDrawInteraction()},visible:function(e){this.layer.setVisible(e),this.updateDrawInteraction()}},mounted:function(){for(var e in this.default_config={data:null,shape_type:"polygon",edge_width:2,edge_color:N(),face_color:"rgba(255, 255, 255, 0.2)",z_index:null,name:"vector",metadata:null,scale:1,translate:0,opacity:1,blending:"additive",visible:!0,size:7,draw_enable:!1,draw_freehand:!0,draw_label:null,draw_size:7,draw_shape_type:"Polygon",draw_face_color:"#FFFFFF0F",draw_edge_width:2,draw_edge_color:N()},this.default_config)this.config[e]||(this.config[e]=this.default_config[e]);if(this.config.init=this.init,Array.isArray(this.config.data)){for(var t=0,n=["shape_type","edge_width","edge_color","face_color","size","z_index","label"];t<n.length;t++){var r=n[t];if(Array.isArray(this.config[r])&&this.config[r].length!==this.config.data.length)throw"Invalid length: ".concat(r," should have ").concat(this.config.data.length," elements.")}this.config.draw_edge_color=this.config.draw_edge_color||this.getConfig("edge_color",0),this.config.draw_edge_width=this.config.draw_edge_width||this.getConfig("edge_width",0),this.config.draw_face_color=this.config.draw_face_color||this.getConfig("face_color",0)}this.draw_edge_color=this.config.draw_edge_color,this.draw_face_color=this.config.draw_face_color,document.addEventListener("keydown",this.keyHandler)},beforeDestroy:function(){document.removeEventListener("keydown",this.keyHandler),this.layer&&(this.removeDrawInteraction(),this.map.removeLayer(this.layer))},created:function(){},methods:{init:function(){var e=this;return Object(F["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getLayer();case 2:return e.layer=t.sent,e.map.addLayer(e.layer),e.updateDrawInteraction(),e.$forceUpdate(),t.abrupt("return",e.layer);case 7:case"end":return t.stop()}}),t)})))()},setDrawType:function(e){this.config.draw_shape_type=e,this.$forceUpdate(),this.updateDrawInteraction()},keyHandler:function(e){this.selected&&this.visible&&("Backspace"===e.code||"Delete"===e.code?this.deleteDraw():"KeyZ"===e.code&&(e.metaKey||e.ctrlKey)?this.undoDraw():"ArrowRight"===e.code?e.metaKey||e.ctrlKey?this.moveSelected(1,0):e.shiftKey?this.moveSelected(30,0):this.moveSelected(10,0):"ArrowLeft"===e.code?e.metaKey||e.ctrlKey?this.moveSelected(-1,0):e.shiftKey?this.moveSelected(-30,0):this.moveSelected(-10,0):"ArrowUp"===e.code?e.metaKey||e.ctrlKey?this.moveSelected(0,1):e.shiftKey?this.moveSelected(0,30):this.moveSelected(0,10):"ArrowDown"===e.code&&(e.metaKey||e.ctrlKey?this.moveSelected(0,-1):e.shiftKey?this.moveSelected(0,-30):this.moveSelected(0,-10)))},moveSelected:function(e,t){var n=this.select.getFeatures();n.forEach((function(n){n.getGeometry().translate(e,t)}))},getConfig:function(e,t){return Array.isArray(this.config[e])?this.config[e][t||0]:this.config[e]},getFeaturesFromConfig:function(){var e={line:"LineString",path:"LineString",polygon:"Polygon",rectangle:"Polygon",point:"MultiPoint","multi-point":"MultiPoint"},t=[],n=this.config.data;if(["point","multi-point","MultiPoint"].includes(this.config.shape_type)){var r={type:"Feature"};r.geometry={type:"MultiPoint",coordinates:n},r.properties={label:this.getConfig("label"),size:this.getConfig("size"),edge_width:this.getConfig("edge_width"),edge_color:this.getConfig("edge_color"),face_color:this.getConfig("face_color")},t=[r]}else for(var i=0;i<n.length;i++){var a={},o=this.getConfig("shape_type",i);o=e[o]||o,a.type="Feature",a.geometry={type:o,coordinates:"Polygon"===o?[n[i]]:n[i]},a.properties={label:this.getConfig("label",i),size:this.getConfig("size"),edge_width:this.getConfig("edge_width",i),edge_color:this.getConfig("edge_color",i),face_color:this.getConfig("face_color",i)},t.push(a)}var s={type:"FeatureCollection",features:t},c=new W["a"];return c.readFeatures(s)},getLayer:function(){var e=this;return Object(F["a"])(regeneratorRuntime.mark((function t(){var n,r,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.config.data,"string"!==typeof n){t.next=5;break}e.vector_source=new B["a"]({url:n,format:new W["a"]}),t.next=12;break;case 5:if(!(n instanceof File)){t.next=11;break}return e.vector_source=new B["a"],t.next=9,e.loadFeatures(n);case 9:t.next=12;break;case 11:n?(e.vector_source=new B["a"],r=e.getFeaturesFromConfig(),e.vector_source.addFeatures(r)):e.vector_source=new B["a"];case 12:return i=new E["a"]({source:e.vector_source}),i.setStyle(e.featureStyle),i.getLayerAPI=e.getLayerAPI,e.vector_source.on("addfeature",(function(t){t.feature._undoing?delete t.feature._undoing:e.draw_history.push({add:t.feature})})),e.vector_source.on("removefeature",(function(t){t.feature._undoing?delete t.feature._undoing:e.draw_history.push({remove:t.feature})})),t.abrupt("return",i);case 18:case"end":return t.stop()}}),t)})))()},deleteDraw:function(){var e=this;if(this.vector_source)if(this.select){var t=this.select.getFeatures();0===t.length?this.clearFeatures():t.forEach((function(n){e.vector_source.removeFeature(n),t.remove(n)}))}else this.clearFeatures()},undoDraw:function(){var e=this;return Object(F["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.draw_history.length>0&&(n=e.draw_history.pop(),n.add?(r=e.vector_source.getFeatures(),r.forEach((function(t){n.add===t&&(t._undoing=!0,e.vector_source.removeFeature(t),e.select&&e.select.getFeatures().remove(t))}))):n.remove&&(n.remove._undoing=!0,e.vector_source.addFeature(n.remove)));case 1:case"end":return t.stop()}}),t)})))()},getLayerAPI:function(){var e=this;return{_rintf:!0,name:this.config.name,id:this.config.id,clear:function(){e.vector_source.clear(!0)},set_features:function(t){var n=new W["a"],r=n.readFeatures(t);e.vector_source.clear(!0),e.vector_source.addFeatures(r)},add_feature:function(t){var n={type:"FeatureCollection",features:[t]},r=new W["a"],i=r.readFeatures(n);e.vector_source.addFeatures(i)},add_features:function(t){var n=new W["a"],r=n.readFeatures(t);e.vector_source.addFeatures(r)},get_features:function(t){t=t||{},void 0===t.decimals&&(t.decimals=2);var n=e.vector_source.getFeatures(),r=new W["a"],i=r.writeFeaturesObject(n,{decimals:t.decimals});return i}}},clearFeatures:function(){this.vector_source&&window.confirm("Are you sure about removing all the features in this layer (".concat(this.config.name,")?"))&&this.vector_source.clear(!0)},loadFeatures:function(e){var t=this;return new Promise((function(n,r){e||r("No file");var i=new FileReader;i.onload=function(e){var r=JSON.parse(e.target.result),i=new W["a"],a=i.readFeatures(r);t.vector_source.addFeatures(a),n()},i.onerror=function(e){i.abort(),console.error(e)},i.readAsText(e)}))},exportFeatures:function(e){e=void 0===e?1:e;var t=this.vector_source.getFeatures(),n=new W["a"],r=n.writeFeaturesObject(t,{decimals:e}),i=new Blob([JSON.stringify(r)],{type:"text/plain;charset=utf-8"});G(i,this.config.name+"_"+this.config.id+".json")},enableSelectInteraction:function(){this.select=new A["a"]({wrapX:!1}),this.map.addInteraction(this.select),this.modify=new V["a"]({source:this.vector_source}),this.modify.createVertices=!0,this.map.addInteraction(this.modify),this.snap=new M["a"]({source:this.vector_source}),this.map.addInteraction(this.snap)},disableSelectInteraction:function(){this.select&&(this.map.removeInteraction(this.select),this.select=null),this.modify&&(this.map.removeInteraction(this.modify),this.modify=null),this.snap&&(this.map.removeInteraction(this.snap),this.snap=null)},updateDrawInteraction:function(){this.selected&&this.visible&&this.config.draw_enable?this.setupDrawInteraction():this.removeDrawInteraction()},removeDrawInteraction:function(){this.draw&&this.map.removeInteraction(this.draw)},featureStyle:function(e,t){var n=e.get("label"),r=e.get("size"),i=e.get("edge_color"),a=e.get("edge_width"),o=e.get("face_color"),s=new R["c"]({fill:new z["a"]({color:o}),stroke:new T["a"]({color:i,width:a}),text:new D["a"]({text:n,font:"14px Calibri,sans-serif",fill:new z["a"]({color:"#000"}),stroke:new T["a"]({color:i,width:4})}),image:new $["a"]({radius:r/Math.pow(t,1/3),fill:new z["a"]({color:i})})});return s},setupDrawInteraction:function(){var e=this;this.vector_source&&this.$nextTick((function(){e.draw&&e.map.removeInteraction(e.draw);var t,n=e.config.draw_shape_type;n=n.charAt(0).toUpperCase()+n.slice(1),"Square"===n?(n="Circle",t=Object(U["b"])(4)):"Rectangle"===n?(n="Circle",t=Object(U["a"])()):"Star"===n&&(n="Circle",t=function(e,t){for(var n=e[0],r=e[1],i=n[0]-r[0],a=n[1]-r[1],o=Math.sqrt(i*i+a*a),s=Math.atan2(a,i),c=[],l=12,u=0;u<l;++u){var d=s+2*u*Math.PI/l,f=u%2===0?1:.5,p=o*f*Math.cos(d),h=o*f*Math.sin(d);c.push([n[0]+p,n[1]+h])}return c.push(c[0].slice()),t?t.setCoordinates([c]):t=new K["a"]([c]),t});var r=new U["c"]({source:e.vector_source,type:n,freehand:e.config.draw_freehand,style:new R["c"]({fill:new z["a"]({color:e.config.draw_face_color}),stroke:new T["a"]({color:e.config.draw_edge_color,width:e.config.draw_edge_width})}),geometryFunction:t});e.map.addInteraction(r),r.on("drawend",function(){var t=Object(F["a"])(regeneratorRuntime.mark((function t(n){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:r=n.feature,r.set("label",e.config.draw_label),r.set("size",e.config.draw_size),r.set("edge_color",e.config.draw_edge_color),r.set("edge_width",e.config.draw_edge_width),r.set("face_color",e.config.draw_face_color),console.log(e.config);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),e.draw=r}))}}},H=q,Z=(n("8054"),Object(s["a"])(H,I,P,!1,null,null,null)),J=Z.exports,X=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"image-layer"},[e.layer?n("section",[n("b-field",{attrs:{label:"opacity"}},[n("b-slider",{attrs:{min:0,max:1,step:.1},on:{input:e.updateOpacity},model:{value:e.config.opacity,callback:function(t){e.$set(e.config,"opacity",t)},expression:"config.opacity"}})],1)],1):e._e()])},Y=[],Q=(n("5cc6"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e"),n("219c"),n("170b"),n("b39a"),n("72f7"),n("e7df")),ee=n("c810"),te=n("f5dd");function ne(e){return new Promise((function(t,n){var r=new FileReader;r.onload=function(e){t(re(e.target.result))},r.onerror=function(e){n(e)},r.readAsDataURL(e)}))}function re(e){return ie.apply(this,arguments)}function ie(){return ie=Object(F["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=new Image;r.crossOrigin="anonymous",r.onload=function(){var t=document.createElement("canvas"),n=t.getContext("2d");t.width=r.width,t.height=r.height,n.drawImage(r,0,0),e({url:t.toDataURL("image/png"),w:r.width,h:r.height})},r.onerror=function(e){n("image load error:"+String(e))},r.src=t})));case 1:case"end":return e.stop()}}),e)}))),ie.apply(this,arguments)}function ae(e,t,n,r){var i=document.createElement("canvas");i.width=n,i.height=r;var a=i.getContext("2d"),o=a.getImageData(0,0,i.width,i.height),s=o.data,c=n*r,l=new Uint8Array(e.buffer);if(!(e instanceof Uint8Array))throw"unsupported array type";if(1===t)for(var u=0;u<c;u++)s[4*u]=l[u],s[4*u+1]=l[u],s[4*u+2]=l[u],s[4*u+3]=255;else if(2===t)for(var d=0;d<c;d++)s[4*d]=l[2*d],s[4*d+1]=l[2*d+1],s[4*d+2]=0,s[4*d+3]=255;else if(3===t)for(var f=0;f<c;f++)s[4*f]=l[3*f],s[4*f+1]=l[3*f+1],s[4*f+2]=l[3*f+2],s[4*f+3]=255;else if(4===t)for(var p=0;p<c;p++)s[4*p]=l[3*p],s[4*p+1]=l[3*p+1],s[4*p+2]=l[3*p+2],s[4*p+3]=l[4*p+3];return a.putImageData(o,0,0),{url:i.toDataURL("image/png"),w:n,h:r}}var oe={name:"image-layer",type:"2d-image",props:{map:{type:v["a"],default:null},selected:{type:Boolean,default:!1},visible:{type:Boolean,default:!1},config:{type:Object,default:function(){return{}}}},data:function(){return{layer:null}},watch:{visible:function(e){this.layer.setVisible(e)}},mounted:function(){this.config.climit=[4,50],this.config.opacity=1,this.config.sliders=[{name:"Z",min:0,max:1e3,step:1,value:3,changed:function(){console.log("z slider changed.")}},{name:"T",min:0,max:100,step:1,value:3,changed:function(){console.log("t slider changed.")}}],this.config.init=this.init},beforeDestroy:function(){this.layer&&this.map.removeLayer(this.layer)},created:function(){},methods:{init:function(){var e=this;return Object(F["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getLayer();case 2:return e.layer=t.sent,e.map.addLayer(e.layer),e.$forceUpdate(),t.abrupt("return",e.layer);case 6:case"end":return t.stop()}}),t)})))()},updateOpacity:function(){this.layer&&this.layer.setOpacity(this.config.opacity)},selectLayer:function(){},getLayer:function(){var e=this;return Object(F["a"])(regeneratorRuntime.mark((function t(){var n,r,i,a,o,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=e.config.data,"string"!==typeof r){t.next=7;break}return t.next=4,re(e.config.data);case 4:n=t.sent,t.next=26;break;case 7:if(!(r instanceof File)){t.next=13;break}return t.next=10,ne(e.config.data);case 10:n=t.sent,t.next=26;break;case 13:if(!(r&&r.imageType&&r.size&&r.imageType.componentType&&r.data)){t.next=25;break}if("uint8_t"===r.imageType.componentType){t.next=16;break}throw"Unsupported data type: ".concat(r.imageType.componentType);case 16:if(!(r.imageType.components<1&&r.imageType.components>4)){t.next=18;break}throw"Unsupported components number: ".concat(r.imageType.components);case 18:if(2===r.imageType.dimension){t.next=20;break}throw"Dimension must be 2";case 20:if(1===r.imageType.pixelType){t.next=22;break}throw"Pixel type must be 1";case 22:n=ae(r.data,r.imageType.components,r.size[0],r.size[1]),t.next=26;break;case 25:n={url:"https://images.proteinatlas.org/19661/221_G2_1_red_green.jpg",w:2048,h:2048};case 26:return i=[0,0,n.w,n.h],a=new te["a"]({code:"image",units:"pixels",extent:i}),o=new Q["a"]({url:n.url,projection:a,imageExtent:i}),s=new ee["a"]({source:o}),e.$emit("update-extent",{id:e.config.id,extent:i}),t.abrupt("return",s);case 32:case"end":return t.stop()}}),t)})))()}}},se=oe,ce=Object(s["a"])(se,X,Y,!1,null,null,null),le=ce.exports,ue=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"itk-vtk-layer"},[n("section",[n("input",{ref:"file_input",staticStyle:{display:"none"},attrs:{type:"file",multiple:""},on:{change:function(t){e.resolveFiles&&e.resolveFiles(t)}}}),e.showLoadButton?n("b-button",{attrs:{"icon-left":"file-import"},on:{click:function(t){return e.$refs.file_input.click()}}},[e._v(" Load File(s) ")]):e._e()],1),e.layer?n("b-field",{attrs:{label:"opacity"}},[n("b-slider",{attrs:{min:0,max:1,step:.1},on:{input:e.updateOpacity},model:{value:e.config.opacity,callback:function(t){e.$set(e.config,"opacity",t)},expression:"config.opacity"}})],1):e._e(),n("section",{staticStyle:{position:"relative"},attrs:{id:"itk-vtk-control_"+e.config.id}})],1)},de=[],fe=(n("c19f"),n("84c3"),n("53ca")),pe=n("4105"),he=n("1af9"),ge=window.itkVtkViewer,me=function(e){function t(t){t=t||{},e.call(this,t),this.viewerElement=document.createElement("div"),this.viewerElement.classList.add("ol-layer"),this.viewerElement.style.position="absolute",this.sync_callback=t.sync_callback}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getSourceState=function(){return"ready"},t.prototype.render=function(){return this.sync_callback&&this.sync_callback(),this.viewerElement.style.opacity=this.getOpacity(),this.viewerElement.style.width="100%",this.viewerElement},t}(he["a"]);function ye(e){return new Promise((function(t){var n=document.createElement("canvas"),r=n.getContext("2d"),i=new Image;i.onload=function(){n.width=i.width,n.height=i.height,r.drawImage(i,0,0,i.width,i.height);var e=r.getImageData(0,0,i.width,i.height);t({imageType:{dimension:2,pixelType:1,componentType:"uint8_t",components:4},name:"test image",origin:[0,0],spacing:[1,1],direction:{data:[1,0,0,1]},size:[i.width,i.height],data:new Uint8Array(e.data.buffer)})},i.crossOrigin="Anonymous",i.src=e}))}var ve={name:"itk-vtk-layer",type:"itk-vtk",props:{map:{type:v["a"],default:null},selected:{type:Boolean,default:!1},visible:{type:Boolean,default:!1},config:{type:Object,default:function(){return{}}}},data:function(){return{layer:null,mode:"2D",resolveFiles:null,showLoadButton:!1}},watch:{visible:function(e){this.layer.setVisible(e),this.renderWindow.render()}},mounted:function(){this.config.name=this.config.name||"itk-vtk image",this.config.opacity=1,this.config.sliders=[{name:"T",min:0,max:100,step:1,value:3,changed:function(){console.log("t slider changed.")}}],this.config.init=this.init},beforeDestroy:function(){this.layer&&this.map.removeLayer(this.layer)},created:function(){},methods:{init:function(){var e=this;return Object(F["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getLayer();case 2:return e.layer=t.sent,e.map.addLayer(e.layer),e.$forceUpdate(),t.abrupt("return",e.layer);case 6:case"end":return t.stop()}}),t)})))()},updateOpacity:function(){this.layer&&this.layer.setOpacity(this.config.opacity)},selectLayer:function(){},getLayer:function(){var e=this;return Object(F["a"])(regeneratorRuntime.mark((function t(){var n,r,i,a,o,s,c,l,u,d,f,p,h,g,m,y;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n={position:"absolute",width:"100vw",height:"100vh",minHeight:"400px",minWidth:"400px",margin:"1",padding:"1",top:"0",left:"0",overflow:"hidden",display:"block-inline"},r={backgroundColor:[0,0,0,0],containerStyle:n},i=new me,!e.config.data||e.config.data instanceof FileList||e.config.data instanceof File){t.next=20;break}if("object"!==Object(fe["a"])(e.config.data)){t.next=8;break}c=e.config.data,t.next=12;break;case 8:if("string"!==typeof e.config.data){t.next=12;break}return t.next=11,ye(e.config.data);case 11:c=t.sent;case 12:l=ge.utils.vtkITKHelper.convertItkToVtkImage(c),u=l.getExtent(),d=l.getDimensions(),s=2===d.length||3===d.length&&1===d[2],a=ge.createViewer(i.viewerElement,{viewerStyle:r,image:l,pointSets:null,geometries:null,use2D:s,rotate:!1,uiContainer:document.getElementById("itk-vtk-control_"+e.config.id)}),o=[u[0],u[2],u[1],u[3]],t.next=40;break;case 20:if(!(e.config.data instanceof File)){t.next=24;break}f=[e.config.data],t.next=31;break;case 24:if(!(e.config.data instanceof FileList)){t.next=28;break}f=e.config.data,t.next=31;break;case 28:return t.next=30,e.getFiles();case 30:f=t.sent;case 31:return t.next=33,ge.utils.readFiles({files:f});case 33:p=t.sent,p.uiContainer=document.getElementById("toolbar"),s=p.use2D,p.uiContainer=document.getElementById("itk-vtk-control_"+e.config.id),a=ge.createViewer(i.viewerElement,p),h=a.getViewProxy().getRenderer().getVolumes(),h.length>0?(g=h[0].getBounds(),o=[g[0],g[2],g[1],g[3]]):(console.warn("Extent is not set."),o=[0,0,100,100]);case 40:return e.config.name=e.config.name||e.config.type,m=a.getViewProxy(),y=m.getRenderWindow(),y.getViews()[0].initialize(),e.viewProxy=a.getViewProxy(),e.viewProxy.updateOrientation(2,1,[0,1,0]),e.renderWindow=e.viewProxy.getRenderWindow(),e.interactor=e.renderWindow.getInteractor(),s&&e.enableSync(i),e.renderer=e.viewProxy.getRenderer(),a.setUserInterfaceCollapsed(!0),setTimeout((function(){a.setUserInterfaceCollapsed(!1)}),10),e.viewer=a,e.$emit("update-extent",{id:e.config.id,extent:o}),t.abrupt("return",i);case 55:case"end":return t.stop()}}),t)})))()},getFiles:function(){var e=this;return new Promise((function(t){e.showLoadButton=!0,e.resolveFiles=function(n){t(n.target.files),e.resolveFiles=null,e.showLoadButton=!1}}))},enableSync:function(e){var t=this.interactor.getView();t.getContainer().removeEventListener("wheel",this.interactor.handleWheel),t.getContainer().removeEventListener("mousedown",this.interactor.handleMouseDown),e.sync_callback=this.synchronizeVtkCoordinate,this.enableItkInteraction(),this.renderWindow.render()},disableSync:function(e){if(e.sync_callback){e.sync_callback=null;var t=this.interactor.getView();t.getContainer().addEventListener("wheel",this.interactor.handleWheel),t.getContainer().addEventListener("mousedown",this.interactor.handleMouseDown)}this.disableItkInteraction()},convertCoordinates:function(e,t){var n=this.interactor.getView(),r={x:e,y:t},i=n.getContainer().getBoundingClientRect(),a=n.getCanvas(),o=a.width/i.width,s=a.height/i.height,c=this.map.getEventPixel({clientX:r.x/o+i.left,clientY:i.height-r.y/s+i.top}),l=this.map.getCoordinateFromPixelInternal(c),u=ge.utils.vtkCoordinate.newInstance();u.setRenderer(this.renderer),u.setCoordinateSystemToDisplay(),u.setValue(r.x,r.y);var d=u.getComputedWorldValue();return{mapPosition:l,worldPosition:d}},synchronizeMapCoordinate:function(){var e=this.map.getView(),t=e.getResolution(),n=e.getCenter(),r=this.convertCoordinates(0,0),i=this.convertCoordinates(1,1),a=t/(r.mapPosition[0]-i.mapPosition[0]),o=Math.abs((r.worldPosition[0]-i.worldPosition[0])*a);0!==o&&o!==t&&e.setResolution(o);var s=r.worldPosition[0]-r.mapPosition[0],c=r.worldPosition[1]-r.mapPosition[1];e.setCenter([n[0]+s,n[1]+c])},synchronizeVtkCoordinate:function(){var e=this.viewProxy.getCamera(),t=e.getParallelScale(),n=this.convertCoordinates(0,0),r=this.convertCoordinates(100,100),i=t/(n.worldPosition[0]-r.worldPosition[0]),a=Math.abs((n.mapPosition[0]-r.mapPosition[0])*i);a&&a!==t&&(e.setParallelScale(a),this.viewProxy.updateDataProbeSize(),this.viewProxy.updateScaleBar());var o=this.convertCoordinates(0,0),s=o.worldPosition[0]-o.mapPosition[0],c=o.worldPosition[1]-o.mapPosition[1],l=e.getFocalPoint(),u=e.getPosition();e.setFocalPoint(l[0]-s,l[1]-c,l[2]),e.setPosition(u[0]-s,u[1]-c,u[2]),e.computeDistance(),this.viewProxy.renderLater()},enableItkInteraction:function(){var e=this;this.itkInteraction=new pe["b"],this.itkInteraction.handleEvent=function(t){e.itkInteraction.updateTrackedPointers_(t);var n=e.interactor;return"pointermove"==t.type&&n.handleMouseMove(t.originalEvent),!0},this.map.addInteraction(this.itkInteraction)},disableItkInteraction:function(){this.itkInteraction&&this.map.removeInteraction(this.itkInteraction)}}},we=ve,be=(n("6a21"),Object(s["a"])(we,ue,de,!1,null,null,null)),_e=be.exports,xe=n("256f"),ke=n("0af5"),Ce=n("2f62"),Le=window.itkVtkViewer;function Se(e){return Ie.apply(this,arguments)}function Ie(){return Ie=Object(F["a"])(regeneratorRuntime.mark((function e(t){var n,r,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.addLayer,e.next=3,window.imjoyLoader.loadImJoyRPC({api_version:"0.2.3"});case 3:return r=e.sent,e.next=6,r.setupRPC({name:"Kaibu",version:"0.1.0",description:"Kaibu--a web application for visualizing and annotating multi-dimensional images",type:"rpc-window"});case 6:i=e.sent,i.registerCodec({name:"itkimage",decoder:Le.utils.convertToItkImage}),i.registerCodec({name:"ndarray",decoder:Le.utils.ndarrayToItkImage}),a={setup:function(){i.log("Kaibu loaded successfully.")},run:function(e){return Object(F["a"])(regeneratorRuntime.mark((function t(){var r,i,a,o,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.data||!e.data.layers){t.next=22;break}r=[],i=Object(g["a"])(e.data.layers),t.prev=3,i.s();case 5:if((a=i.n()).done){t.next=13;break}return o=a.value,t.next=9,n(o);case 9:s=t.sent,r.push(s.getLayerAPI());case 11:t.next=5;break;case 13:t.next=18;break;case 15:t.prev=15,t.t0=t["catch"](3),i.e(t.t0);case 18:return t.prev=18,i.f(),t.finish(18);case 21:return t.abrupt("return",r);case 22:case"end":return t.stop()}}),t,null,[[3,15,18,21]])})))()},add_layer:n,view_image:function(e,t){return Object(F["a"])(regeneratorRuntime.mark((function r(){var i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t=t||{},t.type=t.type||"2d-image",t.name=t.name||t.type,t.data=e,r.next=6,n(t);case 6:return i=r.sent,r.abrupt("return",i.getLayerAPI());case 8:case"end":return r.stop()}}),r)})))()},add_shapes:function(e,t){return Object(F["a"])(regeneratorRuntime.mark((function r(){var i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t=t||{},t.type="vector",t.data=e,r.next=5,n(t);case 5:return i=r.sent,r.abrupt("return",i.getLayerAPI());case 7:case"end":return r.stop()}}),r)})))()},add_points:function(e,t){return Object(F["a"])(regeneratorRuntime.mark((function r(){var i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t=t||{},t.type="vector",t.data=e,t.shape_type="MultiPoint",r.next=6,n(t);case 6:return i=r.sent,r.abrupt("return",i.getLayerAPI());case 8:case"end":return r.stop()}}),r)})))()}},i.export(a);case 11:case"end":return e.stop()}}),e)}))),Ie.apply(this,arguments)}var Pe=n("aa47"),Fe={},Oe={};for(var je in r)Fe[r[je].name]=r[je],Oe[r[je].type]=r[je].name;Fe["gallery"]=S;var Ee=function(e,t,n){return Pe["a"].create(e,Object(m["a"])(Object(m["a"])({},t),{},{onEnd:function(e){var r=t.layer_configs.length-e.oldIndex-1,i=t.layer_configs.length-e.newIndex-1,a=t.layer_configs,o=a[r];if(i>r)for(var s=r;s<i;s++)a[s]=a[s+1];else for(var c=r;c>i;c--)a[c]=a[c-1];a[i]=o,n.componentInstance.$emit("sorted",a)}}))},Re={name:"sortable",bind:function(e,t,n){var r=e.querySelector(".menu-list");r._sortable=Ee(r,t.value,n)},update:function(e,t,n){var r=e.querySelector(".menu-list");r._sortable.destroy(),r._sortable=Ee(r,t.value,n)},unbind:function(e){var t=e.querySelector(".menu-list");t._sortable.destroy()}};function ze(e,t,n){var r;return function(){var i=this,a=arguments,o=function(){r=null,n||e.apply(i,a)},s=n&&!r;clearTimeout(r),r=setTimeout(o,t),s&&e.apply(i,a)}}function Te(){return"ontouchstart"in window}var De={name:"ImageViewer",components:Fe,directives:{sortable:Re},data:function(){return{sortableOptions:{delay:Te()?100:null,chosenClass:"is-primary",draggable:".layer-item"},position:"static",open:!1,expandOnHover:!1,mobile:"fullwidth",reduce:!1,screenWidth:1e3,showGallery:!1,newLayerType:null,collections:null,layerTypes:Oe}},mounted:function(){this.init(),this.sortableOptions.layer_configs=this.layer_configs,window.addEventListener("resize",this.updateSize),window.dispatchEvent(new Event("resize")),this.openSidebar()},beforeDestroy:function(){window.removeEventListener("resize",this.updateSize)},computed:Object(m["a"])({sliderWidth:function(){return this.open&&"static"===this.position?"calc(100% - 310px)":"calc(100% - 20px )"},viewerWidth:function(){return this.open&&"static"===this.position?"calc(100% - 260px)":"calc(100%)"}},Object(Ce["b"])({layers:function(e){return e.layers},layer_configs:function(e){return e.layer_configs},currentLayer:function(e){return e.currentLayer},map:function(e){return e.map},activeSliders:function(e){return e.activeSliders}})),methods:{loadFiles:function(e){var t,n=e.target.files,r={".json":"vector",".jpg":"2d-image",".png":"2d-image",".tif":"itk-vtk"},i=Object(g["a"])(n);try{for(i.s();!(t=i.n()).done;){for(var a=t.value,o=!1,s=0,c=Object.keys(r);s<c.length;s++){var l=c[s];if(a.name.endsWith(l)){this.addLayer({type:r[l],name:a.name,data:a}),o=!0;break}}o||this.addLayer({type:"itk-vtk",name:a.name,data:a})}}catch(u){i.e(u)}finally{i.f()}},goto:function(e){window.open(e,"_blank")},closeSidebar:function(){this.open=!1,setTimeout((function(){window.dispatchEvent(new Event("resize"))}),300)},openSidebar:function(){var e=this;setTimeout((function(){e.open=!0,window.dispatchEvent(new Event("resize"))}),300)},updateSize:function(){var e=this;ze((function(){e.screenWidth=window.innerWidth,e.screenWidth>800?("static"!=e.position&&(e.open=!0),e.position="static"):("absolute"!=e.position&&(e.open=!1),e.position="absolute"),e.$forceUpdate()}),250)()},layerSorted:function(){this.$store.commit("sortLayers")},removeLayer:function(e){this.$store.commit("removeLayer",e),this.$forceUpdate()},toggleVisible:function(e){this.$store.commit("toggleVisible",e),this.$forceUpdate()},selectLayer:function(e){this.$store.commit("setCurrentLayer",e)},newLayer:function(e){this.addLayer({type:e,name:e+"-"+b()})},addLayer:function(e){var t=this;return new Promise((function(n,r){e.id=b(),t.$store.dispatch("addLayer",e),setTimeout((function(){t.layers[e.id]?n(t.layers[e.id]):r("Failed to add layer")}),0)}))},updateExtent:function(e){var t=new xe["b"]({code:"image",units:"pixels",extent:e.extent});this.map.setView(new y["a"]({projection:t,center:Object(ke["x"])(e.extent),zoom:1,minZoom:-10}))},init:function(){var e=[0,0,1024,968],t=new xe["b"]({code:"xkcd-image",units:"pixels",extent:e}),n=new v["a"]({interactions:Object(w["a"])({altShiftDragRotate:!1,pinchRotate:!1}),target:"map",layers:[],view:new y["a"]({projection:t,center:Object(ke["x"])(e),zoom:2,maxZoom:8})});this.$store.commit("setMap",n),window.self!==window.top?Se({addLayer:this.addLayer}):(this.addLayer({type:"itk-vtk",name:"example image",data:"https://images.proteinatlas.org/19661/221_G2_1_red_green.jpg"}),this.addLayer({type:"vector",name:"shape vectors",data:"https://gist.githubusercontent.com/oeway/7c62128939a7f9b1701e2bbd72b809dc/raw/example_shape_vectors.json"}))}}},$e=De,Ae=(n("2d07"),Object(s["a"])($e,p,h,!1,null,null,null)),Ve=Ae.exports;i["a"].use(f["a"]);var Me=[{path:"/",redirect:{name:"App"}},{path:"/app",name:"App",component:Ve},{path:"/about",name:"About",component:function(){return n.e("about").then(n.bind(null,"f820"))}}],Ue=new f["a"]({base:"/",routes:Me}),Be=Ue,We=n("289d");n("5abe"),n("c975"),n("a434");i["a"].use(Ce["a"]);var Ke=new Ce["a"].Store({state:{layers:{},layer_configs:[],activeSliders:null,currentLayer:null,map:null},actions:{addLayer:function(e,t){e.commit("addLayer",t),i["a"].nextTick((function(){t.init&&t.init().then((function(n){n.config=t,n.getLayerAPI=n.getLayerAPI||function(){},e.commit("initialized",n),e.commit("setCurrentLayer",n.config),e.commit("sortLayers")}))}))}},mutations:{sortLayers:function(e){for(var t=0;t<e.layer_configs.length;t++)e.layers[e.layer_configs[t].id]?e.layers[e.layer_configs[t].id].setZIndex(t):console.warn("Layer not ready",e.layer_configs[t])},initialized:function(e,t){e.layers[t.config.id]=t,t.setZIndex(e.layer_configs.length-1)},addLayer:function(e,t){void 0===t.visible&&(t.visible=!0),e.layer_configs.push(t)},removeLayer:function(e,t){t.selected=!1;var n=e.layer_configs.indexOf(t);n>=0&&e.layer_configs.splice(n,1)},toggleVisible:function(e,t){t.visible=!t.visible},setCurrentLayer:function(e,t){e.currentLayer!==t&&(e.currentLayer&&(e.currentLayer.selected=!1),e.currentLayer=t,t.sliders&&(e.activeSliders=t.sliders),t.selected=!0)},setMap:function(e,t){e.map=t}}});i["a"].use(We["a"]),i["a"].config.productionTip=!1,new i["a"]({router:Be,render:function(e){return e(u)},store:Ke}).$mount("#app")},"6a21":function(e,t,n){"use strict";var r=n("e38f"),i=n.n(r);i.a},8054:function(e,t,n){"use strict";var r=n("b3e1"),i=n.n(r);i.a},b3e1:function(e,t,n){},e38f:function(e,t,n){}});
//# sourceMappingURL=app.349d2b89.js.map